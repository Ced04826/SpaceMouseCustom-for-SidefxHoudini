# Space Mouse Control for Houdini

Control Houdini's Network Editor and 3D Viewport with a 3Dconnexion Space Mouse.

## Architecture

```
┌─────────────────────┐     UDP      ┌─────────────────────┐
│  spacemouse_        │ ──────────▶  │  Houdini Receiver   │
│  standalone.py      │  localhost   │  (hou.session)      │
│  (external process) │    :19879    │                     │
└─────────────────────┘              └─────────────────────┘
        │                                     │
        ▼                                     ▼
   Raw HID via hidapi              Network Editor / Viewport
   (requires admin to               camera manipulation
    stop 3Dconnexion driver)
```

**Why this architecture?**
- 3Dconnexion driver must be stopped for raw HID access
- Running HID reader inside Houdini causes driver conflicts
- UDP allows clean separation and easy debugging

## Quick Start

### 1. Start Receiver in Houdini

Use the **"Space Mouse"** shelf (saved to `~/Documents/houdini21.0/toolbar/spacemouse.shelf`):
- Click **"Start Receiver"**

Or manually:
```python
import sys
sys.path.append(r"D:\2026\Q1\Houdini\Plugins")
from spacemouse_network_pan.spacemouse_standalone import start_receiver
start_receiver()
```

### 2. Start Space Mouse Reader

Right-click `start_spacemouse_pan.bat` → **Run as administrator**

This stops the 3Dconnexion driver and starts reading raw HID input.

## Modes

| Mode | Description | Shelf Tool |
|------|-------------|------------|
| `network` | Pan/zoom Network Editor | SM Network |
| `viewport` | Tumble-style 3D navigation | SM Viewport |
| `viewport_fps` | First-person/drone 3D navigation | SM FPS |

### Mode Details

**Network Mode:**
- X axis → horizontal pan
- Y axis → vertical pan  
- Z axis → zoom

**Viewport Mode:**
- Translation: Camera-local truck/pedestal/dolly
- Rotation: Pitch/yaw/roll around camera axes

**Viewport FPS Mode:**
- Translation: Camera-local drone movement
- Rotation: About camera center (no pivot/orbit)

## Configuration

Edit `config.json` or use shelf tools:

```json
{
    "mode": "network",
    "network_axis_multiplier": {
        "pan_horizontal": 1.0,
        "pan_vertical": 1.0,
        "zoom": 1.0
    },
    "viewport_axis_mapping": {
        "translate_x": "x",
        "translate_y": "-z",
        "translate_z": "y",
        "rotate_x": "rx",
        "rotate_y": "-rz",
        "rotate_z": "-ry"
    },
    "viewport_speed": {
        "translate": 2.5,
        "rotate": 6.0
    },
    "viewport_axis_multiplier": {
        "translate_x": 1.0,
        "translate_y": 1.0,
        "translate_z": 1.0,
        "rotate_x": 1.0,
        "rotate_y": 1.0,
        "rotate_z": 1.0
    },
    "fps_axis_multiplier": {
        "translate_x": 1.0,
        "translate_y": 1.0,
        "translate_z": 1.0,
        "rotate_x": 1.0,
        "rotate_y": 1.0,
        "rotate_z": 1.0
    },
    "button_hotkeys": {
        "network": { "button_1": "none", "button_2": "none" },
        "viewport": { "button_1": "none", "button_2": "none" },
        "viewport_fps": { "button_1": "none", "button_2": "none" }
    }
}
```

Axis values: `x`, `y`, `z`, `rx`, `ry`, `rz` (prefix `-` to invert)

Per-axis speed: `final = base_speed * axis_multiplier` (defaults to `1.0`).

Button hotkeys:
- Configure per mode under `button_hotkeys` using strings like `Ctrl+Shift+S`, `Alt+F`, `Space`, `F1`.
- Set to `none` to disable.

Hover refresh (optional):
- Set `hover_refresh.enabled` to `true` to reduce hover-preselect “sticking” while navigating.
- `hover_refresh.method`: `win32` (injects `WM_MOUSEMOVE`, recommended), `qt` (synthetic move events), or `cursor` (temporarily nudges cursor by `jitter_px`).
- `hover_refresh.hz` controls refresh rate.

Auto mode switch (optional):
- Set `auto_mode_switch.enabled` to `true` to automatically route SpaceMouse input to the Network Editor when your cursor is over a Network Editor pane.

## Shelf Tools

| Tool | Function |
|------|----------|
| Start Receiver | Start UDP receiver in Houdini |
| Stop Receiver | Stop receiver and cleanup |
| SM Network | Switch to Network Editor mode |
| SM Viewport | Switch to 3D Viewport mode |
| Reload Config | Apply config.json changes |
| Debug Info | Show receiver state and message count |

## Files

| File | Purpose |
|------|---------|
| `spacemouse_standalone.py` | Main implementation (HID reader + Houdini receiver) |
| `config.json` | User configuration |
| `start_spacemouse_pan.bat` | Launcher (stops driver, starts reader) |
| `restore_3dconnexion.bat` | Restore 3Dconnexion driver |

## Troubleshooting

**"Failed to bind to port"** → Restart Houdini or change port in config.json

**No movement** → Ensure batch file was run as administrator

**Code changes not taking effect** → Must stop and restart receiver (class is defined inside function, reload doesn't update running instance)

## Requirements

- Windows
- Houdini 21+ (uses PySide6)
- 3Dconnexion Space Mouse
- `hidapi` package (`pip install hidapi`)
